!!!
%html
  %head
    %title Infrastructure Admin - OK-OFFLINE
    %meta{name: "viewport", content: "width=device-width, initial-scale=1"}
    = csrf_meta_tags
    = csp_meta_tag
    
    %style
      :css
        /* Berkeley Mono Font */
        @font-face {
          font-family: 'Berkeley Mono';
          src: url('/fonts/BerkeleyMono-Regular.woff2') format('woff2'),
               url('/fonts/BerkeleyMono-Regular.woff') format('woff');
          font-weight: normal;
          font-style: normal;
        }
        
        /* Basic Admin Styles */
        * { box-sizing: border-box; }
        
        body {
          font-family: 'Berkeley Mono', monospace;
          margin: 0;
          padding: 0;
          background: #f5f5f5;
          color: #333;
          line-height: 1.6;
          font-size: 16px;
        }
        
        .admin-header {
          background: #8B0000;
          color: white;
          padding: 1rem 2rem;
          box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .admin-header h1 {
          margin: 0;
          font-size: 1.5rem;
        }
        
        .admin-nav {
          background: #fff;
          border-bottom: 1px solid #ddd;
          padding: 0 2rem;
        }
        
        .admin-nav a {
          display: inline-block;
          padding: 0.75rem 1rem;
          color: #333;
          text-decoration: none;
          border-bottom: 2px solid transparent;
        }
        
        .admin-nav a:hover {
          border-bottom-color: #8B0000;
        }
        
        .admin-container {
          max-width: 1200px;
          margin: 2rem auto;
          padding: 0 2rem;
        }
        
        .notice, .alert {
          padding: 1rem;
          margin-bottom: 1rem;
          border-radius: 4px;
        }
        
        .notice {
          background: #d4edda;
          color: #155724;
          border: 1px solid #c3e6cb;
        }
        
        .alert {
          background: #f8d7da;
          color: #721c24;
          border: 1px solid #f5c6cb;
        }
        
        .btn {
          display: inline-block;
          padding: 0.5rem 1rem;
          background: #8B0000;
          color: white;
          text-decoration: none;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-family: inherit;
        }
        
        .btn:hover {
          background: #a00000;
        }
        
        .btn-secondary {
          background: #666;
        }
        
        .btn-secondary:hover {
          background: #777;
        }
        
        .btn-danger {
          background: #dc3545;
        }
        
        .btn-danger:hover {
          background: #c82333;
        }
        
        table {
          width: 100%;
          background: white;
          border-collapse: collapse;
          box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        th, td {
          padding: 0.75rem;
          text-align: left;
          border-bottom: 1px solid #ddd;
        }
        
        th {
          background: #f8f9fa;
          font-weight: bold;
        }
        
        tr:hover {
          background: #f8f9fa;
        }
        
        .form-group {
          margin-bottom: 1.5rem;
        }
        
        label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: bold;
          font-size: 1.05rem;
        }
        
        input[type="text"], 
        input[type="number"], 
        input[type="url"], 
        input[type="email"],
        input[type="file"],
        select,
        textarea {
          width: 100%;
          padding: 0.75rem;
          border: 1px solid #ddd;
          border-radius: 4px;
          font-family: inherit;
          font-size: 1.1rem;
        }
        
        textarea {
          min-height: 100px;
          resize: vertical;
        }
        
        .card {
          background: white;
          padding: 1.5rem;
          margin-bottom: 1.5rem;
          border-radius: 4px;
          box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .card h2 {
          margin-top: 0;
        }
        
        .actions {
          margin-top: 1rem;
          display: flex;
          gap: 0.5rem;
        }
        
        .field_with_errors {
          display: inline;
        }
        
        .field_with_errors input,
        .field_with_errors textarea {
          border-color: #dc3545;
        }
        
        .error-message {
          color: #dc3545;
          font-size: 0.875rem;
          margin-top: 0.25rem;
        }
        
        .photo-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
          gap: 1rem;
          margin-top: 1rem;
        }
        
        .photo-card {
          background: white;
          border: 1px solid #ddd;
          border-radius: 4px;
          overflow: hidden;
        }
        
        .photo-card img {
          width: 100%;
          height: 150px;
          object-fit: cover;
        }
        
        .photo-card-body {
          padding: 0.5rem;
        }
        
        .nested-fields {
          border-left: 3px solid #8B0000;
          padding-left: 1rem;
          margin-bottom: 1rem;
        }
        
        .remove-field {
          color: #dc3545;
          text-decoration: none;
          font-size: 0.875rem;
        }
        
        .add-field {
          color: #28a745;
          text-decoration: none;
        }
        
  %body
    %header.admin-header
      %h1 Infrastructure Admin
    
    %nav.admin-nav
      = link_to 'All Infrastructure', admin_infrastructures_path
      = link_to 'Add New', new_admin_infrastructure_path
      = link_to 'Import from JSON', '#'
      = link_to 'Exit Admin', '/'
    
    .admin-container
      - if notice
        .notice= notice
      - if alert
        .alert= alert
        
      = yield
    
    :javascript
      // Simple nested fields handler
      document.addEventListener('DOMContentLoaded', function() {
        // Handle remove nested fields
        document.addEventListener('click', function(e) {
          if (e.target.classList.contains('remove-field')) {
            e.preventDefault();
            const fieldset = e.target.closest('.nested-fields');
            const destroyField = fieldset.querySelector('input[name*="_destroy"]');
            if (destroyField) {
              destroyField.value = '1';
              fieldset.style.display = 'none';
            } else {
              fieldset.remove();
            }
          }
        });
        
        // Handle add nested fields
        document.addEventListener('click', function(e) {
          if (e.target.classList.contains('add-field')) {
            e.preventDefault();
            const container = document.querySelector(e.target.dataset.target);
            const template = container.querySelector('.nested-fields:last-child');
            if (template) {
              const newField = template.cloneNode(true);
              // Clear values
              newField.querySelectorAll('input, textarea').forEach(input => {
                input.value = '';
                // Update field names
                const name = input.name;
                const newId = new Date().getTime();
                input.name = name.replace(/\[\d+\]/, '[' + newId + ']');
                input.id = input.id.replace(/_\d+_/, '_' + newId + '_');
              });
              container.appendChild(newField);
            }
          }
        });
      });